<?php

namespace Tests\Unit\Services\Contract;

use App\Models\Airport;
use App\Models\CommunityJob;
use App\Models\CommunityJobContract;
use App\Services\Contracts\CreateCommunityContract;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class CreateCommunityContractTest extends TestCase
{
    use RefreshDatabase;
    protected CreateCommunityContract $createCommunityContract;
    protected Model $communityJob;
    protected Model $communityJobContract;

    protected function setUp(): void
    {
        parent::setUp(); // TODO: Change the autogenerated stub
        $aymn = Airport::factory()->create(['identifier' => 'AYMN']);
        $aymr = Airport::factory()->create(['identifier' => 'AYMR']);

        $this->communityJob = CommunityJob::factory()->create();
        $this->communityJobContract = CommunityJobContract::factory()->create([
            'community_job_id' => $this->communityJob->id,
            'dep_airport_id' => $aymr->id,
            'arr_airport_id' => $aymn->id,
        ]);
        $this->createCommunityContract = app()->make(CreateCommunityContract::class);
    }

    /**
     * A basic unit test example.
     */
    public function test_contract_created(): void
    {
        $this->createCommunityContract->execute($this->communityJobContract);
        $this->assertDatabaseHas('contracts', ['community_job_contract_id' => $this->communityJobContract->id]);
    }
}
